<!--pages/index/index.wxml-->
<view class="container">
  <!-- хКаш╜╜ф╕н -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <view class="loading-text">хКаш╜╜ф╕н...</view>
  </view>
  
  <!-- цЬкчЩ╗х╜ХчК╢цАБ -->
  <view wx:elif="{{!isLoggedIn}}" class="not-login-container">
    <view class="welcome-block card">
      <view class="title">цмвш┐Оф╜┐чФищУ╢щУГхБех║╖чобхо╢</view>
      <view class="subtitle">ф╕Уф╕║ф╕ншАБх╣┤ф║║шо╛шобчЪДхБех║╖чобчРЖх░ПчиЛх║П</view>
      <view class="mt-20">
        <button class="btn btn-lg" bindtap="goToLogin">члЛхН│чЩ╗х╜Х/ц│ихЖМ</button>
      </view>
      
      <view class="mt-30 introduction">
        <view class="subtitle">ф╕╗шжБхКЯшГ╜</view>
        <view class="feature-item">
          <text class="feature-icon">ЁЯПГ</text>
          <text class="feature-text">ф╕кцАзхМЦш┐РхКицЦ╣цбИ</text>
        </view>
        <view class="feature-item">
          <text class="feature-icon">ЁЯУК</text>
          <text class="feature-text">ш┐РхКихБех║╖цХ░цНошо░х╜Х</text>
        </view>
        <view class="feature-item">
          <text class="feature-icon">ЁЯСитАНЁЯСйтАНЁЯСзтАНЁЯСж</text>
          <text class="feature-text">хБех║╖чд╛хМ║ф║дц╡Б</text>
        </view>
        <view class="feature-item">
          <text class="feature-icon">ЁЯУЪ</text>
          <text class="feature-text">ф╕Уф╕ЪхБех║╖чЯешпЖ</text>
        </view>
      </view>
    </view>
  </view>
  
  <!-- чЩ╗х╜ХхРОчЪДф╕╗щб╡ -->
  <view wx:else class="logged-container">
    <!-- чФицИ╖чоАф╗ЛхТМхБех║╖цбгцбИхЕехПг -->
    <view class="user-card card">
      <view class="user-info">
        <image class="user-avatar" src="{{userInfo.avatar || '/assets/images/default-avatar.png'}}"></image>
        <view class="user-detail">
          <view class="user-name">{{userInfo.nickname || 'хБех║╖чФицИ╖'}}</view>
          <view class="user-health-tag" bindtap="goToHealthProfile">цЯечЬЛхБех║╖цбгцбИ</view>
        </view>
      </view>
    </view>
    
    <!-- ф╗КцЧеш┐РхКишобхИТ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">ф╗КцЧеш┐РхКишобхИТ</text>
      </view>
      
      <view wx:if="{{exercisePlan}}" class="card" bindtap="goToPlanDetail" data-id="{{exercisePlan.id}}">
        <view class="plan-title">{{exercisePlan.name}}</view>
        <view class="plan-progress">
          <progress percent="{{exercisePlan.completionRate}}" stroke-width="8" color="#4CAF50" backgroundColor="#e6e6e6" />
          <text class="progress-text">хоМцИРчОЗ: {{exercisePlan.completionRate}}%</text>
        </view>
        <view class="flex-row align-center justify-between mt-10">
          <text class="text-light">х╝АхзЛцЧецЬЯ: {{exercisePlan.startDate}}</text>
          <button class="btn-sm btn" bindtap="goToRecordExercise">шо░х╜Хш┐РхКи</button>
        </view>
      </view>
      
      <view wx:else class="card">
        <view class="no-data-tip">
          <text>цЪВцЧаш┐РхКишобхИТ</text>
          <view class="mt-10">
            <button class="btn" bindtap="goToCreatePlan">хИ╢хоЪш┐РхКишобхИТ</button>
          </view>
        </view>
      </view>
    </view>
    
    <!-- ф╗КцЧеш┐РхКишо░х╜Х -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">ф╗КцЧеш┐РхКишо░х╜Х</text>
      </view>
      
      <view wx:if="{{todayRecord && todayRecord.length > 0}}" class="card">
        <view wx:for="{{todayRecord}}" wx:key="id" class="record-item">
          <view class="flex-row justify-between">
            <text class="record-name">{{item.exerciseName}}</text>
            <text class="record-duration">{{item.duration}}хИЖщТЯ</text>
          </view>
          <view class="flex-row mt-10">
            <text class="record-tag">{{item.intensity}}</text>
            <text class="record-time">{{item.date}}</text>
          </view>
        </view>
      </view>
      
      <view wx:else class="card">
        <view class="no-data-tip">
          <text>ф╗КцЧецЪВцЧаш┐РхКишо░х╜Х</text>
          <view class="mt-10">
            <button class="btn" bindtap="goToRecordExercise">шо░х╜Хф╗КцЧеш┐РхКи</button>
          </view>
        </view>
      </view>
    </view>
    
    <!-- хБех║╖чЯешпЖцОишНР -->
    <view class="section">
      <view class="section-header flex-row justify-between">
        <text class="section-title">хБех║╖чЯешпЖцОишНР</text>
        <text class="more-link" bindtap="goToKnowledgeList">цЯечЬЛцЫ┤хдЪ</text>
      </view>
      
      <view wx:if="{{healthArticles && healthArticles.length > 0}}" class="knowledge-list">
        <view wx:for="{{healthArticles}}" wx:key="id" class="card knowledge-card" bindtap="goToArticleDetail" data-id="{{item.id}}">
          <view class="flex-row">
            <view class="knowledge-content">
              <view class="knowledge-title">{{item.title}}</view>
              <view class="knowledge-summary">{{item.summary || 'чВ╣хЗ╗цЯечЬЛшпжцГЕ'}}</view>
              <view class="knowledge-meta">
                <text class="knowledge-category">{{item.category}}</text>
                <text class="knowledge-date">{{item.publishedAt}}</text>
              </view>
            </view>
            <image wx:if="{{item.imageUrl}}" class="knowledge-image" src="{{item.imageUrl}}" mode="aspectFill"></image>
          </view>
        </view>
      </view>
      
      <view wx:else class="card">
        <view class="no-data-tip">
          <text>цЪВцЧацОишНРхБех║╖чЯешпЖ</text>
        </view>
      </view>
    </view>
    
    <!-- чд╛хМ║чГнщЧишпЭщвШ -->
    <view class="section">
      <view class="section-header flex-row justify-between">
        <text class="section-title">чд╛хМ║чГнщЧишпЭщвШ</text>
        <text class="more-link" bindtap="goToCommunityList">хПВф╕Ошоишо║</text>
      </view>
      
      <view wx:if="{{trendingTopics && trendingTopics.length > 0}}" class="card">
        <view wx:for="{{trendingTopics}}" wx:key="topic" class="topic-item">
          <view class="topic-name">#{{item.topic}}#</view>
          <view class="topic-meta">
            <text class="topic-posts">{{item.postCount}}ф╕кшоишо║</text>
            <text class="topic-likes">{{item.totalLikes}}ф╕кчВ╣ш╡Ю</text>
          </view>
        </view>
      </view>
      
      <view wx:else class="card">
        <view class="no-data-tip">
          <text>цЪВцЧачГнщЧишпЭщвШ</text>
        </view>
      </view>
    </view>
  </view>
</view> 